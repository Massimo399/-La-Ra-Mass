<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>√Ä La Ra'Mass ‚Äî Cours de natation √† Charleroi</title>
  <meta name="description" content="Le√ßons priv√©es de natation pour enfants & ados √† Charleroi (~15 km). R√©servation en ligne de cr√©neaux de 30 minutes. Bienveillance, technique, progression." />
  <style>
    :root{ --bg:#0b132b; --panel:#ffffff; --ink:#0f172a; --muted:#64748b; --brand:#0ea5e9; --ring:#bae6fd; }
    *{box-sizing:border-box}
    html,body{margin:0}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial; color:var(--ink); background:linear-gradient(180deg,#0ea4e944 0%, #ffffff 40%), var(--panel)}
    a{color:var(--brand)}
    header{background:var(--bg); color:#fff; position:sticky; top:0; z-index:10; border-bottom:1px solid #0b1220}
    .container{max-width:1100px; margin:auto; padding:16px}
    nav{display:flex; gap:16px; align-items:center; flex-wrap:wrap}
    nav a{color:#fff; text-decoration:none; opacity:.9}
    nav a:hover{opacity:1}
    .brand{font-weight:800; letter-spacing:.3px; margin-right:auto}
    section{padding:22px 0}
    h1{margin:0 0 8px; font-size:28px}
    h2{margin:0 0 10px; font-size:22px}
    h3{margin:0 0 10px; font-size:18px}
    .hero{padding:48px 0 18px;color:#0b132b}
    .hero .wrap{background:#e0f2fe; border:1px solid #bae6fd; border-radius:20px; padding:22px}
    .lead{color:#0b132b; max-width:70ch}
    .btn{appearance:none; border:none; border-radius:12px; padding:10px 14px; font-weight:700; cursor:pointer}
    .btn.primary{background:var(--brand); color:#fff}
    .btn.ghost{background:#fff; color:var(--brand); border:1px solid var(--brand)}
    .card{background:#fff; border:1px solid #e2e8f0; border-radius:18px; padding:16px; box-shadow:0 12px 30px rgba(2,6,23,.06)}
    .muted{color:var(--muted)}
    .row{display:flex; gap:10px; flex-wrap:wrap}
    .grid{display:grid; gap:12px}
    .two{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    @media (max-width:800px){.two{grid-template-columns:1fr}}
    select,input,textarea{width:100%; padding:10px; border:1px solid #e2e8f0; border-radius:10px; font:inherit}
    select:focus,input:focus,textarea:focus,button:focus{outline:none; box-shadow:0 0 0 3px var(--ring)}
    .days{display:grid; grid-template-columns:repeat(7,1fr); gap:8px}
    @media (max-width:900px){.days{grid-template-columns:repeat(2,1fr)}}
    .day-col{background:#f8fafc; border:1px solid #e2e8f0; border-radius:14px; padding:10px}
    .day-head{font-weight:700; margin-bottom:8px; display:flex; justify-content:space-between; align-items:center}
    .slot{display:block; width:100%; text-align:center; padding:8px; border:1px solid #e5e7eb; background:#fff; border-radius:10px; cursor:pointer}
    .slot:hover{border-color:#0ea5e9}
    .slot.selected{background:#0ea5e9; color:#fff; border-color:#0ea5e9}
    .slot.full{opacity:.5; text-decoration:line-through; cursor:not-allowed}
    footer{padding:30px 16px; color:#334155}
    .foot-grid{display:grid; grid-template-columns:1fr auto; align-items:center}
    .wa-bubble{position:fixed; right:16px; bottom:16px; width:56px; height:56px; background:#25D366; display:grid; place-items:center; color:#fff; border-radius:50%; text-decoration:none; font-weight:900; box-shadow:0 12px 30px rgba(0,0,0,.2)}
  </style>
</head>
<body>
  <header>
    <div class="container">
      <nav>
        <div class="brand">√Ä La Ra'Mass</div>
        <a href="#accueil">Accueil</a>
        <a href="#presentation">Pr√©sentation</a>
        <a href="#planning">Planning & R√©servation</a>
        <a href="#tarifs">Tarifs</a>
        <a href="#contact">Contact</a>
      </nav>
    </div>
  </header>

  <main id="accueil" class="container">
    <section class="hero">
      <div class="wrap">
        <h1>Natation ‚Ä¢ Charleroi et alentours (~15 km)</h1>
        <p class="lead">Le√ßons priv√©es de 30 minutes pour enfants & adolescents ‚Äî p√©dagogie positive, progression mesurable, et bonne humeur garantie. R√©servez en quelques clics.</p>
        <div class="row">
          <a class="btn primary" href="#planning">R√©server un cr√©neau</a>
          <a class="btn ghost" href="#presentation">Rencontrer Massimo</a>
        </div>
      </div>
    </section>

    <section id="presentation">
      <h2>Massimo ‚Äî Coach de natation</h2>
      <div class="card">
        <div class="two">
          <div>
            <p>Moi c'est Massimo, 25 ans. J'ai √©tudi√© dans le domaine du sport et je suis √©galement animateur. J'accorde une grande importance √† l'√©coute, √† la bienveillance et √† la bonne humeur pour cr√©er un cadre motivant et s√©curisant.</p>
            <ul>
              <li>Accompagnement sur‚Äëmesure (d√©butant √† perfectionnement)</li>
              <li>Focus technique : respiration, battements, alignement, virages</li>
              <li>Feedback clair √† chaque s√©ance</li>
              <li>Possible dans la piscine de votre choix autour de Charleroi (~15 km)</li>
            </ul>
          </div>
          <div>
            <div class="card muted">Chaque cr√©neau dure 30 minutes. Zone d‚Äôintervention : Charleroi et alentours (~15 km).</div>
          </div>
        </div>
      </div>
    </section>

    <section id="planning">
      <h2>Planning & R√©servation <small class="muted">*</small></h2>
      <div class="muted" style="margin-bottom:8px">Entr√©e piscine incluse. Cr√©neaux de 30 minutes* ‚Äî horaires auto‚Äëcalcul√©s selon la piscine choisie. Samedi & dimanche selon disponibilit√©s.</div>

      <div class="grid" style="grid-template-columns:1fr;">
        <div class="card">
          <div class="two">
            <label>Choisir une piscine :
              <select id="poolSelect" autocomplete="off">
                <option value="helios">Piscine H√©lios ‚Äî Gilly (Charleroi)</option>
                <option value="sirena">Sir√©na ‚Äî Ch√¢telet/Farciennes</option>
                <option value="fleurus">Piscine communale ‚Äî Fleurus</option>
                <option value="fontaine">Piscine ‚Äî Fontaine‚Äël'√âv√™que</option>
                <option value="courcelles">Piscine Hiss√©ho ‚Äî Courcelles</option>
                <option value="ext">Charleroi‚Äëles‚ÄëBains (ext√©rieur, saison)</option>
              </select>
            </label>
            <label>P√©riode :
              <select id="periodSelect" autocomplete="off">
                <option value="school">P√©riode scolaire</option>
                <option value="holiday">Cong√©s scolaires</option>
              </select>
            </label>
          </div>

          <div class="row" style="justify-content:space-between; margin-top:10px">
            <div class="row">
              <button class="btn ghost" id="prevWeek">‚óÄ Semaine -1</button>
              <button class="btn ghost" id="nextWeek">Semaine +1 ‚ñ∂</button>
              <label class="row" style="align-items:center">
                <input id="extendEvening" type="checkbox" style="width:auto; margin-right:6px" /> √âtendre le soir (jamais au‚Äëdel√† des horaires officiels)
              </label>
            </div>
            <div id="weekLabel" class="muted"></div>
          </div>

          <div id="days" class="days" style="margin-top:12px" aria-live="polite"></div>

          <div class="muted" style="margin-top:12px">* Merci d'√™tre pr√©sent(e) au moins 10 minutes √† l'avance pour l'accueil et la pr√©paration.</div>
        </div>

        <div class="card">
          <h3>Finaliser la r√©servation</h3>
          <div class="two">
            <label>Nom & Pr√©nom<input id="name" autocomplete="name" placeholder="Ex: Martin Dupont"/></label>
            <label>Email<input id="email" type="email" autocomplete="email" placeholder="exemple@mail.com"/></label>
            <label>T√©l√©phone<input id="phone" type="tel" autocomplete="tel" placeholder="Ex: +32 479 87 94 46"/></label>
            <label>Piscine souhait√©e  <input id="poolText" placeholder="Nom / adresse de la piscine"/></label>
          </div>
          <label style="display:block; margin-top:8px">Cr√©neau choisi
            <input id="picked" readonly placeholder="S√©lectionnez un cr√©neau dans le planning"/>
          </label>
          <label style="display:block; margin-top:8px">Remarques
            <textarea id="notes" rows="3" placeholder="Information utile (niveau, objectifs, pr√©f√©rences...)"></textarea>
          </label>

          <div class="row" style="margin-top:12px; justify-content:flex-end">
            <button class="btn ghost" id="downloadICS">T√©l√©charger .ics</button>
            <button class="btn ghost" id="payNow">Payer maintenant</button>
            <button class="btn primary" id="reserve">R√©server & enregistrer</button>
          </div>
          <div id="savedMsg" class="card" style="display:none; margin-top:10px; background:#ecfdf5; border-color:#bbf7d0; color:#065f46">R√©servation enregistr√©e ! Vous pouvez t√©l√©charger l'√©v√®nement (.ics), payer en ligne et/ou envoyer une demande de confirmation par email.</div>
          <div class="row" style="margin-top:10px">
            <a id="emailLink" class="btn ghost" href="#" target="_blank" rel="noopener">Besoin d'une confirmation √©crite ? Envoyer une demande par email</a>
          </div>
          <div class="muted" style="margin-top:10px">‚ö†Ô∏è Les horaires peuvent varier (vacances, maintenance). * Arrivez 10 min √† l'avance.</div>
        </div>
      </div>
    </section>

    <section id="tarifs">
      <h2>Tarifs</h2>
      <div class="two">
        <div class="card">
          <h3>S√©ance √† l'unit√©</h3>
          <p style="font-size:42px; font-weight:800; margin:0">25 ‚Ç¨</p>
          <div class="muted">Dur√©e : 30 minutes ‚Äî entr√©e piscine incluse.</div>
        </div>
        <div class="card">
          <h3>Forfait 10 s√©ances</h3>
          <p style="font-size:42px; font-weight:800; margin:0">212,50 ‚Ç¨</p>
          <div class="muted">Remise 15% incluse (soit ‚àí37,50 ‚Ç¨), valable pour 10 cr√©neaux de 30 minutes.</div>
        </div>
      </div>
      <div class="muted" style="margin-top:10px">Le tarif inclut l'entr√©e √† la piscine. Des frais de d√©placement peuvent s'appliquer selon la distance.</div>
    </section>

    <section id="contact">
      <h2>Contact</h2>
      <div class="card">
        <p>Email : <a href="mailto:pasetti.massimo@hotmail.com">pasetti.massimo@hotmail.com</a><br/>T√©l√©phone : <a href="tel:+32479879446">+32 479 87 94 46</a></p>
        <p><a id="waLink" class="btn primary" href="#" target="_blank" rel="noopener">WhatsApp</a></p>
        <div class="muted">Interventions dans les piscines de votre choix autour de Charleroi (~15 km¬†: Farciennes, Ch√¢telet, Fleurus, Courcelles, Montigny‚Äële‚ÄëTilleul, Fontaine‚Äël‚Äô√âv√™que‚Ä¶).</div>
        <div style="margin-top:8px" class="row">
          <a class="btn ghost" href="#planning">Aller au planning</a>
          <a class="btn ghost" href="#tarifs">Voir les tarifs</a>
          <a class="btn ghost" href="#presentation">Pr√©sentation</a>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container foot-grid">
      <div>¬©  √Ä La Ra'Mass ‚Äî Massimo</div>
      <div class="muted">RGPD : donn√©es de r√©servation stock√©es localement sur votre appareil uniquement.</div>
    </div>
  </footer>

  <a class="wa-bubble" id="waBubble" href="#" target="_blank" rel="noopener" aria-label="Contacter sur WhatsApp">WA</a>

  <script>

/*
  Reservation Engine ‚Äî patch drop‚Äëin SANS changer le design / couleurs / photos
  Gardez EXACTEMENT votre HTML/CSS. Ce fichier remplace uniquement la logique r√©servation.

  üí° CONFIGUREZ ci‚Äëdessous les s√©lecteurs si vos IDs/classes diff√®rent.
*/
(function(){
  // =================== CONFIG S√âLECTEURS (adaptez si besoin) ===================
  const SEL = {
    poolSelect:    '#poolSelect',    // select Piscine
    periodSelect:  '#periodSelect',  // select P√©riode (scolaire / cong√©s)
    extendEvening: '#extendEvening', // checkbox √âtendre le soir (optionnel)
    prevWeek:      '#prevWeek',
    nextWeek:      '#nextWeek',
    weekLabel:     '#weekLabel',
    daysContainer: '#days',          // conteneur de colonnes de jours

    // R√©servation (infos contact)
    name:    '#name',
    email:   '#email',
    phone:   '#phone',
    poolText:'#poolText',            // champ libre piscine
    notes:   '#notes',
    picked:  '#picked',              // champ lecture cr√©neau choisi

    // Actions
    reserveBtn:   '#reserve',
    downloadICS:  '#downloadICS',
    emailLink:    '#emailLink',
    payBtn:       '#payNow',

    // WhatsApp
    waBubble: '#waBubble',
    waLink:   '#waLink',

    // (facultatif) message sauvegarde
    savedMsg: '#savedMsg'
  };

  // =================== HORAIRES LOCAUX (aucun fetch ‚áí pas de CORS) ===================
  const POOLS = {
    helios: { label: 'Piscine H√©lios ‚Äî Gilly (Charleroi)',
      school:   { weekday: ['15:30','18:00'], saturday: ['09:00','18:00'], sunday: ['09:00','12:00'] },
      holiday:  { weekday: ['10:00','19:00'], saturday: ['09:00','18:00'], sunday: ['09:00','12:00'] }
    },
    sirena: { label: 'Sir√©na ‚Äî Ch√¢telet/Farciennes',
      school:   { weekday: ['15:30','18:30'], saturday: ['09:00','18:00'], sunday: ['09:00','12:00'] },
      holiday:  { weekday: ['10:00','19:00'], saturday: ['09:00','18:00'], sunday: ['09:00','12:00'] }
    },
    fleurus: { label: 'Piscine communale ‚Äî Fleurus',
      school:   { weekday: ['15:30','18:00'], saturday: ['09:00','18:00'], sunday: ['09:00','12:00'] },
      holiday:  { weekday: ['10:00','19:00'], saturday: ['09:00','18:00'], sunday: ['09:00','12:00'] }
    },
    fontaine: { label: "Piscine ‚Äî Fontaine‚Äël'√âv√™que",
      school:   { weekday: ['15:30','18:00'], saturday: ['09:00','18:00'], sunday: ['09:00','12:00'] },
      holiday:  { weekday: ['10:00','19:00'], saturday: ['09:00','18:00'], sunday: ['09:00','12:00'] }
    },
    courcelles: { label: 'Piscine Hiss√©ho ‚Äî Courcelles',
      school:   { weekday: ['15:30','18:00'], saturday: ['09:00','18:00'], sunday: ['09:00','12:00'] },
      holiday:  { weekday: ['10:00','19:00'], saturday: ['09:00','18:00'], sunday: ['09:00','12:00'] }
    },
    ext: { label: 'Charleroi‚Äëles‚ÄëBains (ext√©rieur, saison)',
      school:   { weekday: ['15:30','19:00'], saturday: ['09:00','19:00'], sunday: ['09:00','12:30'] },
      holiday:  { weekday: ['10:00','20:00'], saturday: ['09:00','20:00'], sunday: ['09:00','13:00'] }
    }
  };

  const RULES = {
    slotMinutes: 30,
    weeksSpan: 8,
    minWeekdayStart: '15:30',
    maxWeekdayEnd: '18:00'
  };

  const DB_KEY = 'alamass_reservations_v2';

  // =================== Utils ===================
  const $ = (s)=>document.querySelector(s);
  const $$ = (s)=>Array.from(document.querySelectorAll(s));
  const pad=(n)=>String(n).padStart(2,'0');
  const toISODate=(d)=>`${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
  const addMinutes=(d,m)=>{const x=new Date(d); x.setMinutes(x.getMinutes()+m); return x};
  const parseHM=(s)=>{const [h,m]=s.split(':').map(Number); return {h,m}};
  const maxTime=(a,b)=>{const A=parseHM(a),B=parseHM(b); return (A.h>B.h || (A.h===B.h && A.m>B.m))? a : b};
  const minTime=(a,b)=>{const A=parseHM(a),B=parseHM(b); return (A.h<B.h || (A.h===B.h && A.m<B.m))? a : b};
  const readDB=()=>{try{return JSON.parse(localStorage.getItem(DB_KEY)||'{}')}catch{return{}}};
  const writeDB=(db)=>localStorage.setItem(DB_KEY, JSON.stringify(db));

  // =================== Elements ===================
  const poolSelect    = $(SEL.poolSelect);
  const periodSelect  = $(SEL.periodSelect);
  const extendEvening = $(SEL.extendEvening);
  const prevWeekBtn   = $(SEL.prevWeek);
  const nextWeekBtn   = $(SEL.nextWeek);
  const weekLabel     = $(SEL.weekLabel);
  const daysEl        = $(SEL.daysContainer);

  const nameEl  = $(SEL.name);
  const emailEl = $(SEL.email);
  const phoneEl = $(SEL.phone);
  const poolText= $(SEL.poolText);
  const notesEl = $(SEL.notes);
  const picked  = $(SEL.picked);

  const reserveBtn = $(SEL.reserveBtn);
  const dlICSBtn   = $(SEL.downloadICS);
  const emailLink  = $(SEL.emailLink);
  const payBtn     = $(SEL.payBtn);
  const waBubble   = $(SEL.waBubble);
  const waLink     = $(SEL.waLink);
  const savedMsg   = $(SEL.savedMsg);

  let weekOffset=0, selectedKey=null;

  function monday(base){const d=new Date(base);const day=d.getDay();const diff=(day===0?-6:1-day);d.setDate(d.getDate()+diff+weekOffset*7);d.setHours(0,0,0,0);return d}
  function keyOf(t){return `${toISODate(t)}T${pad(t.getHours())}:${pad(t.getMinutes())}`}
  function isPast(t){return t<new Date()}

  function dayRuleFor(date){
    const pool=POOLS[poolSelect.value]; const period=periodSelect.value; const dow=date.getDay(); const src=pool[period];
    if(dow===0) return src.sunday;
    if(dow===6) return src.saturday;
    const start=maxTime(RULES.minWeekdayStart, src.weekday[0]);
    const endBase = extendEvening?.checked ? src.weekday[1] : RULES.maxWeekdayEnd;
    const end=minTime(endBase, src.weekday[1]);
    return [start,end];
  }

  function* slotsFor(date){
    const rule=dayRuleFor(date); if(!rule) return; const [from,to]=rule; const {h:sh,m:sm}=parseHM(from); const {h:eh,m:em}=parseHM(to);
    const start=new Date(date.getFullYear(),date.getMonth(),date.getDate(),sh,sm,0,0);
    const end  =new Date(date.getFullYear(),date.getMonth(),date.getDate(),eh,em,0,0);
    for(let t=new Date(start); t<addMinutes(end,1); t=addMinutes(t,RULES.slotMinutes)){
      const lastStart=addMinutes(end,-RULES.slotMinutes); if(t>lastStart) break; yield t;
    }
  }

  function selectSlot(key){
    selectedKey=key; if(picked) picked.value=key.replace('T',' √† ');
    $$('.slot').forEach(b=>b.classList.remove('selected'));
    const b=document.querySelector(`.slot[data-key="${CSS.escape(key)}"]`); if(b) b.classList.add('selected');
    updateActions();
  }

  function contactOk(){ return nameEl?.value.trim().length>1 && ((emailEl?.value||'').includes('@') || (phoneEl?.value||'').trim().length>5); }
  function updateActions(){ if(reserveBtn) reserveBtn.disabled=!selectedKey || !contactOk(); if(dlICSBtn) dlICSBtn.disabled=!selectedKey; }

  function render(){
    if(!daysEl) return;
    daysEl.innerHTML='';
    const mon=monday(new Date()); const sun=new Date(mon); sun.setDate(sun.getDate()+6);
    if(weekLabel) weekLabel.textContent = `${mon.toLocaleDateString('fr-BE',{day:'2-digit',month:'2-digit'})} ‚Üí ${sun.toLocaleDateString('fr-BE',{day:'2-digit',month:'2-digit'})}`;

    const db=readDB();
    for(let i=0;i<7;i++){
      const date=new Date(mon); date.setDate(date.getDate()+i);
      const col=document.createElement('div'); col.className='day-col';
      const head=document.createElement('div'); head.className='day-head';
      head.innerHTML = `<span>${date.toLocaleDateString('fr-BE',{weekday:'short'})}</span><span>${date.toLocaleDateString('fr-BE',{day:'2-digit',month:'2-digit'})}</span>`;
      col.appendChild(head);

      let count=0;
      for(const t of slotsFor(date)){
        if(isPast(t)) continue;
        const key=keyOf(t);
        const btn=document.createElement('button'); btn.type='button'; btn.className='slot'; btn.dataset.key=key; btn.textContent=t.toLocaleTimeString('fr-BE',{hour:'2-digit',minute:'2-digit'});
        if(db[key]){ btn.classList.add('full'); btn.textContent+=' (pris)'; btn.disabled=true; }
        btn.addEventListener('click', ()=>selectSlot(key));
        col.appendChild(btn); count++;
      }
      if(count===0){ const empty=document.createElement('div'); empty.className='muted'; empty.textContent='Aucun cr√©neau'; col.appendChild(empty); }
      daysEl.appendChild(col);
    }
    if(prevWeekBtn) prevWeekBtn.disabled=(weekOffset<=0);
    if(nextWeekBtn) nextWeekBtn.disabled=(weekOffset>=RULES.weeksSpan);
    updateActions();
  }

  function saveReservation(){
    if(!selectedKey){ alert('Choisissez un cr√©neau.'); return; }
    if(!contactOk()){ alert('Merci de renseigner Nom et un moyen de contact (email ou t√©l√©phone).'); return; }
    const db=readDB();
    db[selectedKey]={
      name:nameEl?.value||'', email:emailEl?.value||'', phone:phoneEl?.value||'', pool:(poolText?.value||'') || POOLS[poolSelect.value].label,
      notes:notesEl?.value||'', at:new Date().toISOString(), poolKey:poolSelect.value, period:periodSelect.value
    };
    writeDB(db);

    // Email & WhatsApp
    const subject=encodeURIComponent(`R√©servation cours natation ‚Äî ${selectedKey}`);
    const body=encodeURIComponent(
      `Bonjour,

Je confirme ma r√©servation :
`+
      `- Cr√©neau : ${selectedKey}
`+
      `- Nom : ${nameEl?.value||''}
`+
      `- Email : ${emailEl?.value||''}
`+
      `- T√©l√©phone : ${phoneEl?.value||''}
`+
      `- Piscine souhait√©e : ${(poolText?.value||'') || POOLS[poolSelect.value].label}
`+
      ((notesEl?.value)? `- Remarques : ${notesEl.value}
` : '')+
      `
Merci !`
    );
    if(emailLink) emailLink.href=`mailto:pasetti.massimo@hotmail.com?subject=${subject}&body=${body}`;

    const waText=encodeURIComponent(`Bonjour, je viens de r√©server le ${selectedKey}. Nom: ${nameEl?.value||''}. Piscine: ${(poolText?.value||'') || POOLS[poolSelect.value].label}.`);
    if(waBubble) waBubble.href=`https://wa.me/32479879446?text=${waText}`;
    if(waLink) waLink.href=`https://wa.me/32479879446?text=${encodeURIComponent('Bonjour, je souhaite des infos pour les cours de natation.')}`;

    if(savedMsg){ savedMsg.style.display='block'; setTimeout(()=>savedMsg.style.display='none', 5000); }
    render();
  }

  function icsDate(d){return `${d.getFullYear()}${pad(d.getMonth()+1)}${pad(d.getDate())}T${pad(d.getHours())}${pad(d.getMinutes())}00`}
  function buildICS({start,end,title,desc,loc}){
    const uid=`alamass-${Date.now()}@example`;
    return `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//ALaRaMass//Planning//FR
BEGIN:VEVENT
UID:${uid}
DTSTAMP:${icsDate(new Date())}Z
DTSTART:${icsDate(start)}
DTEND:${icsDate(end)}
SUMMARY:${title}
DESCRIPTION:${desc}
LOCATION:${loc}
END:VEVENT
END:VCALENDAR`;
  }
  function downloadICS(){
    if(!selectedKey){ alert('Choisissez un cr√©neau.'); return; }
    const [dateStr,timeStr]=selectedKey.split('T'); const [hh,mm]=timeStr.split(':').map(Number); const [Y,M,D]=dateStr.split('-').map(Number);
    const start=new Date(Y,M-1,D,hh,mm,0,0); const end=addMinutes(start,RULES.slotMinutes);
    const ics=buildICS({start,end,title:`Cours de natation (√Ä La Ra'Mass)`, desc:`Dur√©e 30 min. Contact ${nameEl?.value||''} (${emailEl?.value||phoneEl?.value||''}).`, loc:(poolText?.value||'') || POOLS[poolSelect.value].label});
    const blob=new Blob([ics],{type:'text/calendar'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`reservation-${selectedKey.replace(/[:]/g,'')}.ics`; a.click(); URL.revokeObjectURL(url);
  }
  function pay(){ const msg=encodeURIComponent('Bonjour, je souhaite payer mon cours de natation (r√©servation effectu√©e).'); window.open(`https://wa.me/32479879446?text=${msg}`,'_blank'); }

  document.addEventListener('DOMContentLoaded', ()=>{
    try{
      poolSelect?.addEventListener('change', render);
      periodSelect?.addEventListener('change', render);
      extendEvening?.addEventListener('change', render);
      prevWeekBtn?.addEventListener('click', ()=>{ weekOffset=Math.max(0,weekOffset-1); render(); });
      nextWeekBtn?.addEventListener('click', ()=>{ weekOffset=Math.min(RULES.weeksSpan,weekOffset+1); render(); });
      reserveBtn?.addEventListener('click', saveReservation);
      dlICSBtn?.addEventListener('click', downloadICS);
      payBtn?.addEventListener('click', pay);
      [nameEl,emailEl,phoneEl,poolText,notesEl].forEach(el=> el?.addEventListener('input', updateActions));
      if(waLink) waLink.href=`https://wa.me/32479879446?text=${encodeURIComponent('Bonjour, je souhaite des infos pour les cours de natation.')}`;
      if(waBubble) waBubble.href=waLink.href;
      render(); updateActions();
    }catch(e){ console.error('Erreur init planning', e); }
  });
})();

  </script>
</body>
</html>
